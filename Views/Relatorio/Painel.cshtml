<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>@ViewBag.Title</h2>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="/Home/Index">Home</a>
            </li>
            <li class="breadcrumb-item active">
                <strong>@ViewBag.Title</strong>
            </li>
        </ol>
    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">

    <div class="ibox">
        <div class="ibox-title" style="display: flex;justify-content: space-between;">
            <h4>Filtros</h4>
            <div class="ibox-tools pull-right">
                <a class="collapse-link">
                    <i class="fa fa-chevron-up"></i>
                </a>
            </div>
        </div>
        <div class="ibox-content">
            <div class="row">
                <div class="col-xs-12 col-lg-3">
                    <h5>Data Inicial</h5>
                    <input type="text" class="form-control full-date filtro" id="data-inicial" />
                </div>
                <div class="col-xs-12 col-lg-3">
                    <h5>Data Final</h5>
                    <input type="text" class="form-control full-date filtro" id="data-final" />
                </div>
            </div>
        </div>
    </div>

    <div class="ibox">
        <div class="ibox-title" style="display: flex;justify-content: space-between;">
            <h4>@ViewBag.Title</h4>

        </div>
        <div class="igreja"></div>
        <div class="ibox-content event-holder">
           
         
        </div>
    </div>
</div>

@section Styles {

    <style>
        .event-holder {
            display: flex;
            flex-wrap: wrap;
            justify-content: start;
            align-items: center;
            gap: 20px
        }

        .event {
            border-radius: 12px;
            border: 1px solid #808080;
            padding: 25px;
            height: 355px;
            width: 250px;
        }

        .event img {
            height: 150px;
            max-width: 200px;

        }

        .event-info {
            display: flex;
            justify-content: start;
            align-items: center;
            gap: 5px;
        }

        .event-info span{
            font-size: 15px;
        }

            .event  h4 {
                font-size: 20px;
                word-wrap: break-word;
            }

        .event-info i {
            width: 20px;
        }
    </style>
}

@section Scripts {


    <script>
        $('title').text($('#title').text())

        $(document).off('ready-ajax').on('ready-ajax', () => {

            $("#data-inicial").val(moment().startOf('year').format('DD/MM/YYYY'));
            $("#data-final").val(moment().endOf('year').format('DD/MM/YYYY'));
            loadPainel()

            $('.filtro').on('change', loadPainel)

        });

        function loadPainel() {
            $.ajax(
                {
                    type: "POST",
                    data: {
                        dtIni: moment($("#data-inicial").val(), 'DD/MM/YYYY', 'pt-br').toJSON(),
                        dtFim: moment($("#data-final").val(), 'DD/MM/YYYY', 'pt-br').toJSON(),
                    },
                    url: "/Evento/GetPainelEventos",
                    success: function (data) {
                        $('.igreja').html(`<div class="event">
                <img src="/Arquivo/GetArquivo/${Login.LogoId}" />
                <h4>${Login.Titulo}</h4>
                <div class="event-info">
                    <i class="fa fa-calendar"></i>
                    <span>${data.Eventos.reduce(function (acc, obj) { return acc + obj.Eventos; }, 0) }</span>
                    <small>Evento(s)</small>
                </div>
                <div class="event-info">
                    <i class="fa fa-suitcase"></i>
                    <span>${data.Eventos.reduce(function (acc, obj) { return acc + obj.Participantes; }, 0) }</span>
                    <small>Participantes</small>
                </div>
                <div class="event-info">
                    <i class="fas fa-broom"></i>
                    <span>${data.Eventos.reduce(function (acc, obj) { return acc + obj.Voluntarios; }, 0) }</span>
                    <small>Voluntários</small>
                </div>
                <div class="event-info">
                    <i class="far fa-money-bill-alt"></i>
                    <span>${data.Eventos.reduce(function (acc, obj) { return acc + obj.Total; }, 0).toLocaleString('pt-BR', { minimumFractionDigits: 2, style: 'currency', currency: 'BRL' })}</span>
                    <small>Receita</small>
                </div>
            </div>`

                        )
                        $('.event-holder').html('')

                        data.Eventos.forEach(evento => {
                            $('.event-holder').append(` <div class="event">
                <img src="/Arquivo/GetArquivo/${evento.LogoId || Login.LogoId}" />
                <h4>${evento.Titulo}</h4>
                <div class="event-info">
                    <i class="fa fa-calendar"></i>
                    <span>${evento.Eventos}</span>
                    <small>Evento(s)</small>
                </div>
                <div class="event-info">
                    <i class="fa fa-suitcase"></i>
                    <span>${evento.Participantes}</span>
                    <small>Participantes</small>
                </div>
                <div class="event-info">
                    <i class="fas fa-broom"></i>
                    <span>${evento.Voluntarios}</span>
                    <small>Voluntários</small>
                </div>
                <div class="event-info">
                    <i class="far fa-money-bill-alt"></i>
                    <span>${evento.Total.toLocaleString('pt-BR', { minimumFractionDigits: 2, style: 'currency', currency: 'BRL' })}</span>
                    <small>Receita</small>
                </div>
            </div>`)
                        })

                    }
                });
        }

    </script>
}
